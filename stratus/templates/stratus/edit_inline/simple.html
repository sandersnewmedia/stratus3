{% load i18n admin_static stratus_render %}

<fieldset id="{{ inline_admin_formset.formset.prefix }}-group" class="module aligned simple">
    {{ inline_admin_formset.formset.management_form }}
    {{ inline_admin_formset.formset.non_form_errors }}
    <div class="form-row">
        <div>
            <label>{{ inline_admin_formset.opts.verbose_name_plural|title }}:</label>
            <div class="inlines">
                {% for inline_admin_form in inline_admin_formset %}
                <div id="{{ inline_admin_formset.formset.prefix }}-{% if not forloop.last %}{{ forloop.counter0 }}{% else %}empty{% endif %}" class="inline-related {% if forloop.last %}empty-form last-related{% endif %}">
                    <div class="inline-related-preview">
                        {% for fieldset in inline_admin_form %}
                        {% for line in fieldset %}
                        {% for field in line %}
                        {% render_preview inline_admin_formset.opts.preview_fields field.field %}
                        {% endfor %}
                        {% endfor %}
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</fieldset>

<style type="text/css">
    fieldset.simple .inline-related {
        border: 1px solid #ddd;
        float: left;
        width: 400px;
    }

    fieldset.simple .add-row {
        clear: both;
    }
</style>

<script type="text/javascript">
(function($) {
    $(document).ready(function() {
        var rows = "#{{ inline_admin_formset.formset.prefix }}-group .inline-related";

        console.log(rows);

        $(rows).formset({
            prefix: "{{ inline_admin_formset.formset.prefix }}",
            addText: "{% blocktrans with verbose_name=inline_admin_formset.opts.verbose_name|title %}Add another {{ verbose_name }}{% endblocktrans %}",
            formCssClass: "dynamic-{{ inline_admin_formset.formset.prefix }}",
            deleteCssClass: "inline-deletelink",
            deleteText: "{% trans "Remove" %}",
            emptyCssClass: "empty-form"
        });
    });
})(django.jQuery);
</script>
